<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>OAuth2 + JWT ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
          font-family: 'Segoe UI', sans-serif;
          text-align: center;
          margin-top: 80px;
        }
        h1 { font-size: 26px; margin-bottom: 20px; }
        .btn {
          display: inline-block;
          width: 220px;
          padding: 12px 16px;
          margin: 6px;
          border-radius: 6px;
          border: none;
          font-size: 15px;
          cursor: pointer;
          transition: transform 0.1s ease-in-out;
          color: #fff;
        }
        .btn:hover { transform: scale(1.03); }

        .google   { background-color: #DB4437; }
        .naver    { background-color: #1EC800; }
        .kakao    { background-color: #FEE500; color: #3C1E1E; }
        .facebook { background-color: #1877F2; }
        .action   { background-color: #444; }

        .status {
          margin-top: 40px;
          font-size: 14px;
          color: #555;
          white-space: pre-line;
        }
    </style>
</head>
<body>

<h1>OAuth2 ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ (Google / Naver / Kakao / Facebook)</h1>

<div>
    <a href="/oauth2/authorization/google"><button class="btn google">Google ë¡œê·¸ì¸</button></a>
    <a href="/oauth2/authorization/naver"><button class="btn naver">Naver ë¡œê·¸ì¸</button></a>
    <a href="/oauth2/authorization/kakao"><button class="btn kakao">Kakao ë¡œê·¸ì¸</button></a>
    <a href="/oauth2/authorization/facebook"><button class="btn facebook">Facebook ë¡œê·¸ì¸</button></a>
</div>

<hr style="margin: 30px 0; width: 60%;">

<div>
    <button class="btn action" onclick="reissueToken()">ğŸ”„ í† í° ì¬ë°œê¸‰</button>
    <button class="btn action" onclick="logout()">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
</div>

<div class="status" id="status"></div>

<script>
    window.onload = function() {
      showStatus();
    };

    function showStatus() {
      const accessToken = localStorage.getItem('accessToken');
      const refreshToken = localStorage.getItem('refreshToken');
      const statusEl = document.getElementById('status');

      if (accessToken && refreshToken) {
        statusEl.innerText =
          'âœ… ë¡œê·¸ì¸ ìƒíƒœ\n\n' +
          'Access Token: ' + accessToken.substring(0, 25) + '...\n' +
          'Refresh Token: ' + refreshToken.substring(0, 25) + '...';
      } else {
        statusEl.innerText = 'ğŸ”’ í˜„ì¬ ë¡œê·¸ì•„ì›ƒ ìƒíƒœì…ë‹ˆë‹¤.';
      }
    }

    async function reissueToken() {
      const refreshToken = localStorage.getItem('refreshToken');
      if (!refreshToken) {
        alert('Refresh Tokenì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”.');
        return;
      }

      try {
        const response = await fetch('/auth/refresh', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ refreshToken })
        });

        const result = await response.json();
        if (response.ok && result.success && result.data) {
          const { accessToken: newAccess, refreshToken: newRefresh } = result.data;
          localStorage.setItem('accessToken', newAccess);
          localStorage.setItem('refreshToken', newRefresh);
          alert('ğŸ”„ í† í° ì¬ë°œê¸‰ ì„±ê³µ!');
          showStatus();
        } else {
          alert('âŒ ì¬ë°œê¸‰ ì‹¤íŒ¨: ' + (result.message || 'ì„œë²„ ì˜¤ë¥˜'));
        }
      } catch (err) {
        console.error(err);
        alert('ì¬ë°œê¸‰ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    async function logout() {
      const accessToken = localStorage.getItem('accessToken');
      if (!accessToken) {
        alert('ì´ë¯¸ ë¡œê·¸ì•„ì›ƒ ìƒíƒœì…ë‹ˆë‹¤.');
        return;
      }

      try {
        const response = await fetch('/auth/logout', {
          method: 'POST',
          headers: { 'Authorization': 'Bearer ' + accessToken }
        });

        if (response.ok) {
          localStorage.removeItem('accessToken');
          localStorage.removeItem('refreshToken');
          alert('ğŸšª ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ!');
          showStatus();
        } else {
          alert('âŒ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨');
        }
      } catch (err) {
        console.error(err);
        alert('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
</script>

</body>
</html>
